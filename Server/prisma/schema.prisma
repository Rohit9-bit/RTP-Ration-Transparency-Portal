generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model beneficiary {
  beneficiary_id     String              @id @unique
  full_name          String
  email              String
  phone_no           String
  password           String
  family_size        Int
  state              String
  district           String
  address            String
  ration_card_no     String              @unique
  is_active          Boolean             @default(true)
  security_PIN       Int
  createdAt          DateTime            @default(now())
  updatedAt          DateTime?
  distributionCenter distribution_center @relation(fields: [centerId], references: [center_id])
  centerId           String
  quotas             quota[]
  transaction_logs   transaction_log[]
  grievances         grievance[]
}

model shop_owner {
  manager_id          String               @id @unique
  full_name           String
  email               String
  phone_no            String
  state               String
  district            String
  address             String
  owner_id            String
  password            String
  createdAt           DateTime             @default(now())
  updatedAt           DateTime?
  distribution_center distribution_center?
}

model distribution_center {
  center_id          String              @id @unique
  address            String
  center_name        String
  state              String
  district           String
  createdAt          DateTime            @default(now())
  shopOwner          shop_owner          @relation(fields: [managerId], references: [manager_id])
  managerId          String              @unique
  beneficiaries      beneficiary[]
  transaction_logs   transaction_log[]
  shop_stock_ledgers shop_stock_ledger[]
  grievances         grievance[]
}

model commodity {
  commodity_id      String              @id @unique
  commodity_name    String
  unit              String
  createdAt         DateTime            @default(now())
  transaction_log   transaction_log[]
  shop_stock_ledger shop_stock_ledger[]
  quotas            quota[]
  grievance         grievance[]
}

model quota {
  quota_id           String      @id @unique
  month_year         DateTime    @default(now())
  quantity_entitled  Float
  quantity_remaining Float
  beneficiary        beneficiary @relation(fields: [beneficiaryId], references: [beneficiary_id])
  beneficiaryId      String
  commodity          commodity   @relation(fields: [commodityId], references: [commodity_id])
  commodityId        String
  createdAt          DateTime    @default(now())
  updatedAt          DateTime?

  @@unique([beneficiaryId, commodityId, month_year])
}

model transaction_log {
  transaction_id             String              @id @unique
  quantity_entitled          Float
  quantity_received          Float
  is_verified_by_beneficiery Boolean
  anomaly_type               String?
  beneficiary                beneficiary         @relation(fields: [beneficiaryId], references: [beneficiary_id])
  beneficiaryId              String
  distributionCenter         distribution_center @relation(fields: [centerId], references: [center_id])
  centerId                   String
  commodity                  commodity           @relation(fields: [commodityId], references: [commodity_id])
  commodityId                String
  createdAt                  DateTime            @default(now())
  updatedAt                  DateTime?
}

model shop_stock_ledger {
  ledger_id          String              @id @unique
  stock_in_quantity  Float
  stock_out_quantity Float
  distributionCenter distribution_center @relation(fields: [centerId], references: [center_id])
  centerId           String
  createdAt          DateTime            @default(now())
  updatedAt          DateTime?
  commodity          commodity           @relation(fields: [commodityId], references: [commodity_id])
  commodityId        String
}

model grievance {
  grievance_id       String              @id @unique
  issue_type         String
  description        String?
  status             String              @default("Pending")
  priority_level     String              @default("Medium")
  distributionCenter distribution_center @relation(fields: [centerId], references: [center_id])
  centerId           String
  beneficiary        beneficiary         @relation(fields: [beneficiaryId], references: [beneficiary_id])
  beneficiaryId      String
  commodity          commodity           @relation(fields: [commodityId], references: [commodity_id])
  commodityId        String
  expected_quantity  Float
  actual_quantity    Float
  createdAt          DateTime            @default(now())
  updatedAt          DateTime?
}
